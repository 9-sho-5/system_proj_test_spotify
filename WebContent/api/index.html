<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Spotify</title>
	<link rel="stylesheet" type="text/css" href="./assets/css/index.css"/>
	<link rel="stylesheet" type="text/css" href="./assets/css/reset.css"/>
	<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<style>
</style>
<body>
	<div id="root"></div>
	<script type="text/babel">
		function login() {	
			var url = "login";
			xmlHttpRequest = new XMLHttpRequest();
			xmlHttpRequest.withCredentials = true;
			xmlHttpRequest.onreadystatechange = receiveFromLogin;
			xmlHttpRequest.open("get", url, true);
			xmlHttpRequest.send(null);
		}

		let dom = document.querySelector("#root")
		var cookies = document.cookie; //全てのcookieを取り出して
		var cookiesArray = cookies.split('; '); // ;で分割し配列に
		var loginState = null;
		for(var c of cookiesArray){ //一つ一つ取り出して
			var cArray = c.split('='); //さらに=で分割して配列に
			console.log(cArray[0]);
			if( cArray[0] == 'loginStatus'){ // 取り出したいkeyと合致したら
				loginState = cArray[1]
			}
		}
		console.log(loginState)
		const LoggedIn = () => {
			return (
				<div>
					<p>ログインしました</p>
					<form action="/isp2/api/search" method="get">
						<input type="text" name="keyword" />
						<input type="submit" value="検索" />
					</form>
				</div>
			);
		}
					
		const NotLogin = () => {
			return (
				<button id="login" onClick={ login }>
					ログイン
				</button>
			)
		}
							
		const App = () => {
			let loginElement = document.createElement("div.login_view");
			let imgElement = document.createElement("img");
			imgElement.setAttribute("src", "https://storage.googleapis.com/spotifynewsroom-jp.appspot.com/1/2020/12/Spotify_Logo_CMYK_Black.png");
			loginElement.appendChild(imgElement);
			if(loginState == "loggedIn") {
				var login_flg = true;
			} else if (loginState == "notLoginState" || loginState == null) {
				var login_flg = false;
			}
			return(
				<div className="login_view">
					<img src="https://storage.googleapis.com/spotifynewsroom-jp.appspot.com/1/2020/12/Spotify_Logo_CMYK_Black.png" alt="spotify" />
					{
						login_flg ? <LoggedIn /> : <NotLogin />
					}
				</div>
			);
		}
		ReactDOM.render(<App />, dom);
	</script>
	<script type="text/javascript" src="./assets/javascript/index.js"></script>
</body>
</html>
